<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>マイクとMP3再生</title>
</head>
<body>
  <h1>マイクとMP3再生</h1>

  <p id="mic-status">マイク状態: 未確認</p>

  <!-- マイク使用許可ボタン -->
  <button id="mic-btn">🎤 マイクを使う</button>

  <!-- 音声再生ボタン -->
  <button id="play-btn">▶️ 音声を再生</button>

  <!-- MP3 プレーヤー -->
  <audio id="audio-player" loop>
    <source src="./test.mp3" type="audio/mpeg">
    お使いのブラウザは audio タグをサポートしていません。
  </audio>

  <script>
    // マイク使用リクエスト
    async function requestMicrophoneAccess() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        document.getElementById("mic-status").textContent = "マイク状態: 使用許可されました";
        // ストリームを使用しないなら停止
        stream.getTracks().forEach(track => track.stop());
      } catch (err) {
        document.getElementById("mic-status").textContent = "マイク状態: 許可されませんでした";
        console.error("マイクアクセスエラー:", err);
      }
    }

    // 再生処理
    function playAudio() {
      const audio = document.getElementById("audio-player");
      audio.play().then(() => {
        console.log("再生開始");
      }).catch(err => {
        console.error("再生に失敗:", err);
      });
    }

    // イベントリスナー登録
    document.getElementById("mic-btn").addEventListener("click", requestMicrophoneAccess);
    document.getElementById("play-btn").addEventListener("click", playAudio);
  </script>
</body>
</html>
